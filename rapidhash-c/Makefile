CC = gcc

TEST_VECTOR_TS = \
	test_vector_fast.ts \
	test_vector_protected.ts

TARGETS = $(addprefix ../packages/rapidhash/test/,$(TEST_VECTOR_TS))

all: $(TARGETS)

.PHONY: all clean clean-target

clean:
	rm test_vector_{fast,protected} test_vector_{fast,protected}.ts

clean-target:
	rm $(TARGETS)

clean-all: clean clean-target

rapidhash/rapidhash.h:
	git submodule update --init

test_vector_fast: generate_test_vector.c rapidhash/rapidhash.h
	$(CC) generate_test_vector.c -o $@

test_vector_protected: generate_test_vector.c rapidhash/rapidhash.h
	$(CC) generate_test_vector.c -o $@ -DRAPIDHASH_PROTECTED

test_vector_%.ts: test_vector_%
	echo '/* eslint-disable */' >>$@
	echo '// This file is generated by rapidhash-c/Makefile' >>$@
	git -C rapidhash show --format='// rapidhash revision: %H' --no-patch >>$@
	./$< >>$@

$(TARGETS): $(TEST_VECTOR_TS)
	cp $^ $(dir $@)
